# ===================================================================== #
#  An R package for Fast 'ggplot2' Plotting:                            #
#  https://github.com/msberends/plot2                                   #
#                                                                       #
#  This R package is free software; you can freely use and distribute   #
#  it for both personal and commercial purposes under the terms of the  #
#  GNU General Public License version 2.0 (GNU GPL-2), as published by  #
#  the Free Software Foundation.                                        #
#                                                                       #
#  We created this package for both routine data analysis and academic  #
#  research and it was publicly released in the hope that it will be    #
#  useful, but it comes WITHOUT ANY WARRANTY OR LIABILITY.              #
# ===================================================================== #

#' Methods for [plot2()]
#' 
#' These are the implemented methods for different S3 classes to be used in [plot2()]. Since they have an extensive list of arguments, they are placed here on a separate manual page.
#' @rdname plot2-methods
#' @name plot2-methods
#' @inheritParams plot2
#' @importFrom ggplot2 fortify
#' @importFrom dplyr count filter mutate
#' @importFrom rlang `:=`
#' @export
plot2.default <- function(.data,
                          x = NULL,
                          y = NULL,
                          category = NULL,
                          facet = NULL,
                          type = NULL,
                          x.title = TRUE,
                          y.title = TRUE,
                          category.title = NULL,
                          title = NULL,
                          subtitle = NULL,
                          caption = NULL,
                          tag = NULL,
                          title.linelength = 60,
                          title.colour = getOption("plot2.colour_font_primary", "black"),
                          subtitle.linelength = 60,
                          subtitle.colour = getOption("plot2.colour_font_secondary", "grey35"),
                          na.replace = "",
                          na.rm = FALSE,
                          facet.position = "top",
                          facet.fill = NULL,
                          facet.bold = TRUE,
                          facet.italic = FALSE,
                          facet.size = 10,
                          facet.margin = 8,
                          facet.repeat_lbls_x = TRUE,
                          facet.repeat_lbls_y = NULL,
                          facet.fixed_y = NULL,
                          facet.fixed_x = NULL,
                          facet.drop = FALSE,
                          facet.nrow = NULL,
                          facet.relative = FALSE,
                          x.date_breaks = NULL,
                          x.date_labels = NULL,
                          x.date_remove_years = NULL,
                          category.focus = NULL,
                          colour = getOption("plot2.colour", "ggplot2"),
                          colour_fill = NULL,
                          colour_opacity = 0,
                          x.lbl_angle = 0,
                          x.lbl_align = NULL,
                          x.lbl_italic = FALSE,
                          x.lbl_taxonomy = FALSE,
                          x.remove = FALSE,
                          x.position = "bottom",
                          x.max_items = Inf,
                          x.max_txt = "(rest, x%n)",
                          category.max_items = Inf,
                          category.max_txt = "(rest, x%n)",
                          facet.max_items = Inf,
                          facet.max_txt = "(rest, x%n)",
                          x.breaks = NULL,
                          x.n_breaks = NULL,
                          x.transform = "identity",
                          x.expand = NULL,
                          x.limits = NULL,
                          x.labels = NULL,
                          x.character = NULL,
                          x.drop = FALSE,
                          x.mic = FALSE,
                          x.zoom = FALSE,
                          y.remove = FALSE,
                          y.24h = FALSE,
                          y.age = FALSE,
                          y.scientific = NULL,
                          y.percent = FALSE,
                          y.percent_break = 0.1,
                          y.breaks = NULL,
                          y.n_breaks = NULL,
                          y.limits = NULL,
                          y.labels = NULL,
                          y.expand = NULL,
                          y.transform = "identity",
                          y.position = "left",
                          y.zoom = FALSE,
                          y_secondary = NULL,
                          y_secondary.type = type,
                          y_secondary.title = TRUE,
                          y_secondary.colour = get_colour(getOption("plot2.colour", "ggplot2"), 2),
                          y_secondary.colour_fill = get_colour(getOption("plot2.colour", "ggplot2"), 2),
                          y_secondary.scientific = NULL,
                          y_secondary.percent = FALSE,
                          y_secondary.labels = NULL,
                          category.labels = NULL,
                          category.percent = FALSE,
                          category.breaks = NULL,
                          category.limits = NULL,
                          category.expand = 0,
                          category.midpoint = NULL,
                          category.transform = "identity",
                          category.date_breaks = NULL,
                          category.date_labels = NULL,
                          category.character = NULL,
                          x.sort = NULL,
                          category.sort = TRUE,
                          facet.sort = TRUE,
                          x.complete = NULL,
                          category.complete = NULL,
                          facet.complete = NULL,
                          datalabels = TRUE,
                          datalabels.round = ifelse(y.percent, 2, 1),
                          datalabels.format = "%n",
                          datalabels.colour = "grey25",
                          datalabels.colour_fill = NULL,
                          datalabels.size = (3 * text_factor),
                          datalabels.angle = 0,
                          datalabels.lineheight = 1.0,
                          decimal.mark = dec_mark(),
                          big.mark = big_mark(),
                          summarise_function = base::sum,
                          stacked = FALSE,
                          stacked_fill = FALSE,
                          horizontal = FALSE,
                          reverse = horizontal,
                          smooth = NULL,
                          smooth.method = NULL,
                          smooth.formula = NULL,
                          smooth.se = TRUE,
                          smooth.level = 0.95,
                          smooth.alpha = 0.25,
                          smooth.linewidth = 0.75,
                          smooth.linetype = 3,
                          smooth.colour = NULL,
                          size = NULL,
                          linetype = 1,
                          linewidth = NULL,
                          binwidth = NULL,
                          width = NULL,
                          jitter_seed = NA,
                          violin_scale = "count",
                          legend.position = NULL,
                          legend.title = NULL, # TRUE in numeric categories
                          legend.reverse = FALSE,
                          legend.barheight = 6,
                          legend.barwidth = 1.5,
                          legend.nbin = 300,
                          legend.italic = FALSE,
                          sankey.node_width = 0.15,
                          sankey.node_whitespace = 0.03,
                          sankey.alpha = 0.5,
                          sankey.remove_axes = NULL,
                          zoom = FALSE,
                          sep = " / ",
                          print = FALSE,
                          text_factor = getOption("plot2.text_factor", 1),
                          font = getOption("plot2.font"),
                          theme = getOption("plot2.theme", "theme_minimal2"),
                          background = getOption("plot2.colour_background", "white"),
                          markdown = TRUE,
                          ...) {
  if (is.function(.data)) {
    stop("`plot2()` does not yet support functions to be plotted", call. = FALSE)
  }
  
  if (tryCatch(suppressWarnings(is.atomic(.data) && !is.table(.data) && !is.matrix(.data)), error = function(e) FALSE)) {
    # an atomic vector, such as numeric, character, factor
    y_deparse <- paste0(trimws(deparse(substitute(.data))), collapse = " ")
    if (nchar(y_deparse) > 30) {
      y_deparse <- "y"
    }
    if (missing(.data)) {
      .data <- y
      y_deparse <- "y"
    }
    if (is.character(.data) || is.factor(.data)) {
      new_df <- as.data.frame(table(.data))
      colnames(new_df) <- c(y_deparse, "y")
      new_df <- new_df |> filter(y != 0)
    } else if (is.numeric(.data) && missing(y)) {
      new_df <- data.frame(x = seq_len(length(.data)),
                           y = .data, stringsAsFactors = FALSE)
    } else if (!is.numeric(.data) && missing(x)) {
      new_df <- data.frame(x = .data, stringsAsFactors = FALSE) |> count(x, name = "y")
    }
    if (is.null(type)) {
      type <- getOption("plot2.default_type", "geom_col")
    }
    
  } else {
    # not an atomic vector
    # ggplot2's fortify() will try to make this a data.frame,
    # so that plot2.data.frame() can be called
    new_df <- tryCatch(fortify(.data), error = function(e) NULL)
    if (is.null(new_df)) {
      # then try to make a regular data.frame
      new_df <- tryCatch(as.data.frame(.data, stringsAsFactors = FALSE),
                         error = function(e) NULL)
      if (!is.data.frame(new_df)) {
        stop("Unable to initialise plot2(): input class '", paste(class(.data), collapse = "/"), "' is unsupported",
             call. = FALSE)
      }
      plot2_caution("Input class ", paste0("'", class(.data), "'", collapse = "/"), " was transformed using `as.data.frame()`")
      if (inherits(.data, "table")) {
        # if using `as.data.frame()` on a `table`, the resulting count column with be "Freq"
        if (tryCatch(is.null(y), error = function(e) FALSE)) {
          colnames(new_df)[colnames(new_df) == "Freq"] <- "count"
          y <- str2lang("count")
        } else {
          # this is when y is set to something - put that to the y axis and adjust the data set
          col_fn <- function(y = NULL) data.frame() |> mutate({{ y }} := 0)
          y <- colnames(col_fn({{ y }}))
          colnames(new_df)[colnames(new_df) == "Freq"] <- y
          y <- str2lang(y)
        }
      }
    }
  }
  
  plot2_exec(new_df,
             x = {{ x }},
             y = {{ y }},
             category = {{ category }},
             facet = {{ facet }},
             type = type,
             x.title = {{ x.title }},
             y.title = {{ y.title }},
             category.title = {{ category.title }},
             title = {{ title }},
             subtitle = {{ subtitle }},
             caption = {{ caption }},
             tag = {{ tag }},
             title.linelength = title.linelength,
             title.colour = title.colour,
             subtitle.linelength = subtitle.linelength,
             subtitle.colour = subtitle.colour,
             na.replace = na.replace,
             na.rm = na.rm,
             facet.position = facet.position,
             facet.fill = facet.fill,
             facet.bold = facet.bold,
             facet.italic = facet.italic,
             facet.size = facet.size,
             facet.margin = facet.margin,
             facet.repeat_lbls_x = facet.repeat_lbls_x,
             facet.repeat_lbls_y = facet.repeat_lbls_y,
             facet.fixed_y = facet.fixed_y,
             facet.fixed_x = facet.fixed_x,
             facet.drop = facet.drop,
             facet.nrow = facet.nrow,
             facet.relative = facet.relative,
             x.date_breaks = x.date_breaks,
             x.date_labels = x.date_labels,
             x.date_remove_years = x.date_remove_years,
             category.focus = category.focus,
             colour = colour,
             colour_fill = colour_fill,
             colour_opacity = colour_opacity,
             x.lbl_angle = x.lbl_angle,
             x.lbl_align = x.lbl_align,
             x.lbl_italic = x.lbl_italic,
             x.lbl_taxonomy = x.lbl_taxonomy,
             x.remove = x.remove,
             x.position = x.position,
             x.max_items = x.max_items,
             x.max_txt = x.max_txt,
             category.max_items = category.max_items,
             category.max_txt = category.max_txt,
             facet.max_items = facet.max_items,
             facet.max_txt = facet.max_txt,
             x.breaks = x.breaks,
             x.n_breaks = x.n_breaks,
             x.transform = x.transform,
             x.expand = x.expand,
             x.limits = x.limits,
             x.labels = x.labels,
             x.character = x.character,
             x.drop = x.drop,
             x.mic = x.mic,
             x.zoom = x.zoom,
             y.remove = y.remove,
             y.24h = y.24h,
             y.age = y.age,
             y.scientific = y.scientific,
             y.percent = y.percent,
             y.percent_break = y.percent_break,
             y.breaks = y.breaks,
             y.n_breaks = y.n_breaks,
             y.limits = y.limits,
             y.labels = y.labels,
             y.expand = y.expand,
             y.transform = y.transform,
             y.position = y.position,
             y.zoom = y.zoom,
             y_secondary = {{ y_secondary }},
             y_secondary.type = y_secondary.type,
             y_secondary.title = {{ y_secondary.title }},
             y_secondary.colour = y_secondary.colour,
             y_secondary.colour_fill = y_secondary.colour_fill,
             y_secondary.scientific = y_secondary.scientific,
             y_secondary.percent = y_secondary.percent,
             y_secondary.labels = y_secondary.labels,
             category.labels = category.labels,
             category.percent = category.percent,
             category.breaks = category.breaks,
             category.limits = category.limits,
             category.expand = category.expand,
             category.midpoint = category.midpoint,
             category.transform = category.transform,
             category.date_breaks = category.date_breaks,
             category.date_labels = category.date_labels,
             category.character = category.character,
             x.sort = x.sort,
             category.sort = category.sort,
             facet.sort = facet.sort,
             x.complete = x.complete,
             category.complete = category.complete,
             facet.complete = facet.complete,
             datalabels = {{ datalabels }},
             datalabels.round = datalabels.round,
             datalabels.colour = datalabels.colour,
             datalabels.format = datalabels.format,
             datalabels.colour_fill = datalabels.colour_fill,
             datalabels.size = datalabels.size,
             datalabels.angle = datalabels.angle,
             datalabels.lineheight = datalabels.lineheight,
             decimal.mark = decimal.mark,
             big.mark = big.mark,
             summarise_function = summarise_function,
             stacked = stacked,
             stacked_fill = stacked_fill,
             horizontal = horizontal,
             reverse = reverse,
             smooth = smooth,
             smooth.method = smooth.method,
             smooth.formula = smooth.formula,
             smooth.se = smooth.se,
             smooth.level = smooth.level,
             smooth.alpha = smooth.alpha,
             smooth.linewidth = smooth.linewidth,
             smooth.linetype = smooth.linetype,
             smooth.colour = smooth.colour,
             size = size,
             linetype = linetype,
             linewidth = linewidth,
             binwidth = binwidth,
             width = width,
             jitter_seed = jitter_seed,
             violin_scale = violin_scale,
             legend.position = legend.position,
             legend.title = {{ legend.title }},
             legend.reverse = legend.reverse,
             legend.barheight = legend.barheight,
             legend.barwidth = legend.barwidth,
             legend.nbin = legend.nbin,
             legend.italic = legend.italic,
             sankey.node_width = sankey.node_width,
             sankey.node_whitespace = sankey.node_whitespace,
             sankey.alpha = sankey.alpha,
             sankey.remove_axes = sankey.remove_axes,
             zoom = zoom,
             sep = sep,
             print = print,
             text_factor = text_factor,
             font = font,
             theme = theme,
             background = background,
             markdown = markdown,
             `_misses.x` = missing(x),
             `_misses.y` = missing(y),
             `_misses.category` = missing(category),
             `_misses.facet` = missing(facet),
             `_misses.datalabels` = missing(datalabels),
             `_misses.colour_fill` = missing(colour_fill),
             `_misses.x.title` = missing(x.title),
             `_misses.y.title` = missing(y.title),
             `_misses.title` = missing(title),
             `_misses.subtitle` = missing(subtitle),
             `_misses.tag` = missing(tag),
             `_misses.caption` = missing(caption),
             `_misses.y.percent` = missing(y.percent),
             `_misses.y.percent_break` = missing(y.percent_break),
             `_misses.x.zoom` = missing(x.zoom),
             `_misses.x.max_items` = missing(x.max_items),
             `_misses.facet.fixed_x` = missing(facet.fixed_x),
             `_label.x` = list(...)$`_label.x` %or% deparse(substitute(x)),
             `_label.y` = list(...)$`_label.y` %or% deparse(substitute(y)),
             `_label.category` = list(...)$`_label.category` %or% deparse(substitute(category)),
             `_label.facet` = list(...)$`_label.facet` %or% deparse(substitute(facet)),
             `_label.y_secondary` = list(...)$`_label.y_secondary` %or% deparse(substitute(y_secondary)),
             `_summarise_fn_name` = list(...)$`_summarise_fn_name` %or% deparse(substitute(summarise_function)),
             `_misses.summarise_function` = missing(summarise_function),
             ...)
}

#' @rdname plot2-methods
#' @importFrom dplyr is_grouped_df ungroup
#' @export
plot2.formula <- function(.data = NULL,
                             x = NULL,
                             y = NULL,
                             category = NULL,
                             facet = NULL,
                             type = NULL,
                             x.title = TRUE,
                             y.title = TRUE,
                             category.title = NULL,
                             title = NULL,
                             subtitle = NULL,
                             caption = NULL,
                             tag = NULL,
                             title.linelength = 60,
                             title.colour = getOption("plot2.colour_font_primary", "black"),
                             subtitle.linelength = 60,
                             subtitle.colour = getOption("plot2.colour_font_secondary", "grey35"),
                             na.replace = "",
                             na.rm = FALSE,
                             facet.position = "top",
                             facet.fill = NULL,
                             facet.bold = TRUE,
                             facet.italic = FALSE,
                             facet.size = 10,
                             facet.margin = 8,
                             facet.repeat_lbls_x = TRUE,
                             facet.repeat_lbls_y = NULL,
                             facet.fixed_y = NULL,
                             facet.fixed_x = NULL,
                             facet.drop = FALSE,
                             facet.nrow = NULL,
                             facet.relative = FALSE,
                             x.date_breaks = NULL,
                             x.date_labels = NULL,
                             x.date_remove_years = NULL,
                             category.focus = NULL,
                             colour = getOption("plot2.colour", "ggplot2"),
                             colour_fill = NULL,
                             colour_opacity = 0,
                             x.lbl_angle = 0,
                             x.lbl_align = NULL,
                             x.lbl_italic = FALSE,
                             x.lbl_taxonomy = FALSE,
                             x.remove = FALSE,
                             x.position = "bottom",
                             x.max_items = Inf,
                             x.max_txt = "(rest, x%n)",
                             category.max_items = Inf,
                             category.max_txt = "(rest, x%n)",
                             facet.max_items = Inf,
                             facet.max_txt = "(rest, x%n)",
                             x.breaks = NULL,
                             x.n_breaks = NULL,
                             x.transform = "identity",
                             x.expand = NULL,
                             x.limits = NULL,
                             x.labels = NULL,
                             x.character = NULL,
                             x.drop = FALSE,
                             x.mic = FALSE,
                             x.zoom = FALSE,
                             y.remove = FALSE,
                             y.24h = FALSE,
                             y.age = FALSE,
                             y.scientific = NULL,
                             y.percent = FALSE,
                             y.percent_break = 0.1,
                             y.breaks = NULL,
                             y.n_breaks = NULL,
                             y.limits = NULL,
                             y.labels = NULL,
                             y.expand = NULL,
                             y.transform = "identity",
                             y.position = "left",
                             y.zoom = FALSE,
                             y_secondary = NULL,
                             y_secondary.type = type,
                             y_secondary.title = TRUE,
                             y_secondary.colour = get_colour(getOption("plot2.colour", "ggplot2"), 2),
                             y_secondary.colour_fill = get_colour(getOption("plot2.colour", "ggplot2"), 2),
                             y_secondary.scientific = NULL,
                             y_secondary.percent = FALSE,
                             y_secondary.labels = NULL,
                             category.labels = NULL,
                             category.percent = FALSE,
                             category.breaks = NULL,
                             category.limits = NULL,
                             category.expand = 0,
                             category.midpoint = NULL,
                             category.transform = "identity",
                             category.date_breaks = NULL,
                             category.date_labels = NULL,
                             category.character = NULL,
                             x.sort = NULL,
                             category.sort = TRUE,
                             facet.sort = TRUE,
                             x.complete = NULL,
                             category.complete = NULL,
                             facet.complete = NULL,
                             datalabels = TRUE,
                             datalabels.round = ifelse(y.percent, 2, 1),
                             datalabels.format = "%n",
                             datalabels.colour = "grey25",
                             datalabels.colour_fill = NULL,
                             datalabels.size = (3 * text_factor),
                             datalabels.angle = 0,
                             datalabels.lineheight = 1.0,
                             decimal.mark = dec_mark(),
                             big.mark = big_mark(),
                             summarise_function = base::sum,
                             stacked = FALSE,
                             stacked_fill = FALSE,
                             horizontal = FALSE,
                             reverse = horizontal,
                             smooth = NULL,
                             smooth.method = NULL,
                             smooth.formula = NULL,
                             smooth.se = TRUE,
                             smooth.level = 0.95,
                             smooth.alpha = 0.25,
                             smooth.linewidth = 0.75,
                             smooth.linetype = 3,
                             smooth.colour = NULL,
                             size = NULL,
                             linetype = 1,
                             linewidth = NULL,
                             binwidth = NULL,
                             width = NULL,
                             jitter_seed = NA,
                             violin_scale = "count",
                             legend.position = NULL,
                             legend.title = NULL, # TRUE in numeric categories
                             legend.reverse = FALSE,
                             legend.barheight = 6,
                             legend.barwidth = 1.5,
                             legend.nbin = 300,
                             legend.italic = FALSE,
                             sankey.node_width = 0.15,
                             sankey.node_whitespace = 0.03,
                             sankey.alpha = 0.5,
                             sankey.remove_axes = NULL,
                             zoom = FALSE,
                             sep = " / ",
                             print = FALSE,
                             text_factor = getOption("plot2.text_factor", 1),
                             font = getOption("plot2.font"),
                             theme = getOption("plot2.theme", "theme_minimal2"),
                             background = getOption("plot2.colour_background", "white"),
                             markdown = TRUE,
                          data = NULL,
                             ...) {
  if (is.null(data)) {
    stop("Formula notation requires the `data` argument to be set")
  }
  form <- .data
  .data <- data
  form_elements <- unlist(strsplit(as.character(form), " [\\+\\-] "))
  form_elements <- form_elements[-1]
  
  x <- form_elements[2]
  y = form_elements[1]
  category <- NULL
  facet <- NULL
  if (length(form_elements) > 2) {
    category <- form_elements[3]
  }
  if (length(form_elements) > 3) {
    facet <- form_elements[4]
  }
  
  .data <- .data |>
    select(any_of(c(x, y, category, facet)))
  
  x <- str2lang(x)
  y <- str2lang(y)
  if (!is.null(category)) {
    category <- str2lang(category)
  }
  if (!is.null(facet)) {
    facet <- str2lang(facet)
  }
  
  plot2_exec(.data = .data,
             x = {{ x }},
             y = {{ y }},
             category = {{ category }},
             facet = {{ facet }},
             type = type,
             x.title = {{ x.title }},
             y.title = {{ y.title }},
             category.title = {{ category.title }},
             title = {{ title }},
             subtitle = {{ subtitle }},
             caption = {{ caption }},
             tag = {{ tag }},
             title.linelength = title.linelength,
             title.colour = title.colour,
             subtitle.linelength = subtitle.linelength,
             subtitle.colour = subtitle.colour,
             na.replace = na.replace,
             na.rm = na.rm,
             facet.position = facet.position,
             facet.fill = facet.fill,
             facet.bold = facet.bold,
             facet.italic = facet.italic,
             facet.size = facet.size,
             facet.margin = facet.margin,
             facet.repeat_lbls_x = facet.repeat_lbls_x,
             facet.repeat_lbls_y = facet.repeat_lbls_y,
             facet.fixed_y = facet.fixed_y,
             facet.fixed_x = facet.fixed_x,
             facet.drop = facet.drop,
             facet.nrow = facet.nrow,
             facet.relative = facet.relative,
             x.date_breaks = x.date_breaks,
             x.date_labels = x.date_labels,
             x.date_remove_years = x.date_remove_years,
             category.focus = category.focus,
             colour = colour,
             colour_fill = colour_fill,
             colour_opacity = colour_opacity,
             x.lbl_angle = x.lbl_angle,
             x.lbl_align = x.lbl_align,
             x.lbl_italic = x.lbl_italic,
             x.lbl_taxonomy = x.lbl_taxonomy,
             x.remove = x.remove,
             x.position = x.position,
             x.max_items = x.max_items,
             x.max_txt = x.max_txt,
             category.max_items = category.max_items,
             category.max_txt = category.max_txt,
             facet.max_items = facet.max_items,
             facet.max_txt = facet.max_txt,
             x.breaks = x.breaks,
             x.n_breaks = x.n_breaks,
             x.transform = x.transform,
             x.expand = x.expand,
             x.limits = x.limits,
             x.labels = x.labels,
             x.character = x.character,
             x.drop = x.drop,
             x.mic = x.mic,
             x.zoom = x.zoom,
             y.remove = y.remove,
             y.24h = y.24h,
             y.age = y.age,
             y.scientific = y.scientific,
             y.percent = y.percent,
             y.percent_break = y.percent_break,
             y.breaks = y.breaks,
             y.n_breaks = y.n_breaks,
             y.limits = y.limits,
             y.labels = y.labels,
             y.expand = y.expand,
             y.transform = y.transform,
             y.position = y.position,
             y.zoom = y.zoom,
             y_secondary = {{ y_secondary }},
             y_secondary.type = y_secondary.type,
             y_secondary.title = {{ y_secondary.title }},
             y_secondary.colour = y_secondary.colour,
             y_secondary.colour_fill = y_secondary.colour_fill,
             y_secondary.scientific = y_secondary.scientific,
             y_secondary.percent = y_secondary.percent,
             y_secondary.labels = y_secondary.labels,
             category.labels = category.labels,
             category.percent = category.percent,
             category.breaks = category.breaks,
             category.limits = category.limits,
             category.expand = category.expand,
             category.midpoint = category.midpoint,
             category.transform = category.transform,
             category.date_breaks = category.date_breaks,
             category.date_labels = category.date_labels,
             category.character = category.character,
             x.sort = x.sort,
             category.sort = category.sort,
             facet.sort = facet.sort,
             x.complete = x.complete,
             category.complete = category.complete,
             facet.complete = facet.complete,
             datalabels = {{ datalabels }},
             datalabels.round = datalabels.round,
             datalabels.colour = datalabels.colour,
             datalabels.format = datalabels.format,
             datalabels.colour_fill = datalabels.colour_fill,
             datalabels.size = datalabels.size,
             datalabels.angle = datalabels.angle,
             datalabels.lineheight = datalabels.lineheight,
             decimal.mark = decimal.mark,
             big.mark = big.mark,
             summarise_function = summarise_function,
             stacked = stacked,
             stacked_fill = stacked_fill,
             horizontal = horizontal,
             reverse = reverse,
             smooth = smooth,
             smooth.method = smooth.method,
             smooth.formula = smooth.formula,
             smooth.se = smooth.se,
             smooth.level = smooth.level,
             smooth.alpha = smooth.alpha,
             smooth.linewidth = smooth.linewidth,
             smooth.linetype = smooth.linetype,
             smooth.colour = smooth.colour,
             size = size,
             linetype = linetype,
             linewidth = linewidth,
             binwidth = binwidth,
             width = width,
             jitter_seed = jitter_seed,
             violin_scale = violin_scale,
             legend.position = legend.position,
             legend.title = {{ legend.title }},
             legend.reverse = legend.reverse,
             legend.barheight = legend.barheight,
             legend.barwidth = legend.barwidth,
             legend.nbin = legend.nbin,
             legend.italic = legend.italic,
             sankey.node_width = sankey.node_width,
             sankey.node_whitespace = sankey.node_whitespace,
             sankey.alpha = sankey.alpha,
             sankey.remove_axes = sankey.remove_axes,
             zoom = zoom,
             sep = sep,
             print = print,
             text_factor = text_factor,
             font = font,
             theme = theme,
             background = background,
             markdown = markdown,
             `_misses.x` = missing(x),
             `_misses.y` = missing(y),
             `_misses.category` = missing(category),
             `_misses.facet` = missing(facet),
             `_misses.datalabels` = missing(datalabels),
             `_misses.colour_fill` = missing(colour_fill),
             `_misses.x.title` = missing(x.title),
             `_misses.y.title` = missing(y.title),
             `_misses.title` = missing(title),
             `_misses.subtitle` = missing(subtitle),
             `_misses.tag` = missing(tag),
             `_misses.caption` = missing(caption),
             `_misses.y.percent` = missing(y.percent),
             `_misses.y.percent_break` = missing(y.percent_break),
             `_misses.x.zoom` = missing(x.zoom),
             `_misses.x.max_items` = missing(x.max_items),
             `_misses.facet.fixed_x` = missing(facet.fixed_x),
             `_label.x` = list(...)$`_label.x` %or% deparse(substitute(x)),
             `_label.y` = list(...)$`_label.y` %or% deparse(substitute(y)),
             `_label.category` = list(...)$`_label.category` %or% deparse(substitute(category)),
             `_label.facet` = list(...)$`_label.facet` %or% deparse(substitute(facet)),
             `_label.y_secondary` = list(...)$`_label.y_secondary` %or% deparse(substitute(y_secondary)),
             `_label.y_secondary` = list(...)$`_label.y_secondary` %or% deparse(substitute(y_secondary)),
             `_summarise_fn_name` = list(...)$`_summarise_fn_name` %or% deparse(substitute(summarise_function)),
             `_misses.summarise_function` = missing(summarise_function),
             ...)
  
}

#' @rdname plot2-methods
#' @export
plot2.freq <- function(.data,
                       x = .data$item,
                       y = .data$count,
                       category = NULL,
                       facet = NULL,
                       type = NULL,
                       x.title = "Item",
                       y.title = "Count",
                       category.title = TRUE,
                       title = NULL,
                       subtitle = NULL,
                       caption = NULL,
                       tag = NULL,
                       title.linelength = 60,
                       title.colour = getOption("plot2.colour_font_primary", "black"),
                       subtitle.linelength = 60,
                       subtitle.colour = getOption("plot2.colour_font_secondary", "grey35"),
                       na.replace = "",
                       na.rm = FALSE,
                       facet.position = "top",
                       facet.fill = NULL,
                       facet.bold = TRUE,
                       facet.italic = FALSE,
                       facet.size = 10,
                       facet.margin = 8,
                       facet.repeat_lbls_x = TRUE,
                       facet.repeat_lbls_y = NULL,
                       facet.fixed_y = NULL,
                       facet.fixed_x = NULL,
                       facet.drop = FALSE,
                       facet.nrow = NULL,
                       facet.relative = FALSE,
                       x.date_breaks = NULL,
                       x.date_labels = NULL,
                       x.date_remove_years = NULL,
                       category.focus = NULL,
                       colour = getOption("plot2.colour", "ggplot2"),
                       colour_fill = NULL,
                       colour_opacity = 0,
                       x.lbl_angle = 0,
                       x.lbl_align = NULL,
                       x.lbl_italic = FALSE,
                       x.lbl_taxonomy = FALSE,
                       x.remove = FALSE,
                       x.position = "bottom",
                       x.max_items = Inf,
                       x.max_txt = "(rest, x%n)",
                       category.max_items = Inf,
                       category.max_txt = "(rest, x%n)",
                       facet.max_items = Inf,
                       facet.max_txt = "(rest, x%n)",
                       x.breaks = NULL,
                       x.n_breaks = NULL,
                       x.transform = "identity",
                       x.expand = NULL,
                       x.limits = NULL,
                       x.labels = NULL,
                       x.character = NULL,
                       x.drop = FALSE,
                       x.mic = FALSE,
                       x.zoom = FALSE,
                       y.remove = FALSE,
                       y.24h = FALSE,
                       y.age = FALSE,
                       y.scientific = NULL,
                       y.percent = FALSE,
                       y.percent_break = 0.1,
                       y.breaks = NULL,
                       y.n_breaks = NULL,
                       y.limits = NULL,
                       y.labels = NULL,
                       y.expand = NULL,
                       y.transform = "identity",
                       y.position = "left",
                       y.zoom = FALSE,
                       y_secondary = NULL,
                       y_secondary.type = type,
                       y_secondary.title = TRUE,
                       y_secondary.colour = get_colour(getOption("plot2.colour", "ggplot2"), 2),
                       y_secondary.colour_fill = get_colour(getOption("plot2.colour", "ggplot2"), 2),
                       y_secondary.scientific = NULL,
                       y_secondary.percent = FALSE,
                       y_secondary.labels = NULL,
                       category.labels = NULL,
                       category.percent = FALSE,
                       category.breaks = NULL,
                       category.limits = NULL,
                       category.expand = 0,
                       category.midpoint = NULL,
                       category.transform = "identity",
                       category.date_breaks = NULL,
                       category.date_labels = NULL,
                       category.character = NULL,
                       x.sort = "freq-desc",
                       category.sort = TRUE,
                       facet.sort = TRUE,
                       x.complete = NULL,
                       category.complete = NULL,
                       facet.complete = NULL,
                       datalabels = TRUE,
                       datalabels.round = ifelse(y.percent, 2, 1),
                       datalabels.format = "%n",
                       datalabels.colour = "grey25",
                       datalabels.colour_fill = NULL,
                       datalabels.size = (3 * text_factor),
                       datalabels.angle = 0,
                       datalabels.lineheight = 1.0,
                       decimal.mark = dec_mark(),
                       big.mark = big_mark(),
                       summarise_function = base::sum,
                       stacked = FALSE,
                       stacked_fill = FALSE,
                       horizontal = FALSE,
                       reverse = horizontal,
                       smooth = NULL,
                       smooth.method = NULL,
                       smooth.formula = NULL,
                       smooth.se = TRUE,
                       smooth.level = 0.95,
                       smooth.alpha = 0.25,
                       smooth.linewidth = 0.75,
                       smooth.linetype = 3,
                       smooth.colour = NULL,
                       size = NULL,
                       linetype = 1,
                       linewidth = NULL,
                       binwidth = NULL,
                       width = NULL,
                       jitter_seed = NA,
                       violin_scale = "count",
                       legend.position = NULL,
                       legend.title = NULL, # TRUE in numeric categories
                       legend.reverse = FALSE,
                       legend.barheight = 6,
                       legend.barwidth = 1.5,
                       legend.nbin = 300,
                       legend.italic = FALSE,
                       sankey.node_width = 0.15,
                       sankey.node_whitespace = 0.03,
                       sankey.alpha = 0.5,
                       sankey.remove_axes = NULL,
                       zoom = FALSE,
                       sep = " / ",
                       print = FALSE,
                       text_factor = getOption("plot2.text_factor", 1),
                       font = getOption("plot2.font"),
                       theme = getOption("plot2.theme", "theme_minimal2"),
                       background = getOption("plot2.colour_background", "white"),
                       markdown = TRUE,
                       ...) {
  plot2_exec(as.data.frame(.data, stringsAsFactors = FALSE)[, 1:2, drop = FALSE],
             x = x,
             y = y,
             category = {{ category }},
             facet = {{ facet }},
             type = type,
             x.title = {{ x.title }},
             y.title = {{ y.title }},
             category.title = {{ category.title }},
             title = {{ title }},
             subtitle = {{ subtitle }},
             caption = {{ caption }},
             tag = {{ tag }},
             title.linelength = title.linelength,
             title.colour = title.colour,
             subtitle.linelength = subtitle.linelength,
             subtitle.colour = subtitle.colour,
             na.replace = na.replace,
             na.rm = na.rm,
             facet.position = facet.position,
             facet.fill = facet.fill,
             facet.bold = facet.bold,
             facet.italic = facet.italic,
             facet.size = facet.size,
             facet.margin = facet.margin,
             facet.repeat_lbls_x = facet.repeat_lbls_x,
             facet.repeat_lbls_y = facet.repeat_lbls_y,
             facet.fixed_y = facet.fixed_y,
             facet.fixed_x = facet.fixed_x,
             facet.drop = facet.drop,
             facet.nrow = facet.nrow,
             facet.relative = facet.relative,
             x.date_breaks = x.date_breaks,
             x.date_labels = x.date_labels,
             x.date_remove_years = x.date_remove_years,
             category.focus = category.focus,
             colour = colour,
             colour_fill = colour_fill,
             colour_opacity = colour_opacity,
             x.lbl_angle = x.lbl_angle,
             x.lbl_align = x.lbl_align,
             x.lbl_italic = x.lbl_italic,
             x.lbl_taxonomy = x.lbl_taxonomy,
             x.remove = x.remove,
             x.position = x.position,
             x.max_items = x.max_items,
             x.max_txt = x.max_txt,
             category.max_items = category.max_items,
             category.max_txt = category.max_txt,
             facet.max_items = facet.max_items,
             facet.max_txt = facet.max_txt,
             x.breaks = x.breaks,
             x.n_breaks = x.n_breaks,
             x.transform = x.transform,
             x.expand = x.expand,
             x.limits = x.limits,
             x.labels = x.labels,
             x.character = x.character,
             x.drop = x.drop,
             x.mic = x.mic,
             x.zoom = x.zoom,
             y.remove = y.remove,
             y.24h = y.24h,
             y.age = y.age,
             y.scientific = y.scientific,
             y.percent = y.percent,
             y.percent_break = y.percent_break,
             y.breaks = y.breaks,
             y.n_breaks = y.n_breaks,
             y.limits = y.limits,
             y.labels = y.labels,
             y.expand = y.expand,
             y.transform = y.transform,
             y.position = y.position,
             y.zoom = y.zoom,
             y_secondary = {{ y_secondary }},
             y_secondary.type = y_secondary.type,
             y_secondary.title = {{ y_secondary.title }},
             y_secondary.colour = y_secondary.colour,
             y_secondary.colour_fill = y_secondary.colour_fill,
             y_secondary.scientific = y_secondary.scientific,
             y_secondary.percent = y_secondary.percent,
             y_secondary.labels = y_secondary.labels,
             category.labels = category.labels,
             category.percent = category.percent,
             category.breaks = category.breaks,
             category.limits = category.limits,
             category.expand = category.expand,
             category.midpoint = category.midpoint,
             category.transform = category.transform,
             category.date_breaks = category.date_breaks,
             category.date_labels = category.date_labels,
             category.character = category.character,
             x.sort = x.sort,
             category.sort = category.sort,
             facet.sort = facet.sort,
             x.complete = x.complete,
             category.complete = category.complete,
             facet.complete = facet.complete,
             datalabels = {{ datalabels }},
             datalabels.round = datalabels.round,
             datalabels.colour = datalabels.colour,
             datalabels.format = datalabels.format,
             datalabels.colour_fill = datalabels.colour_fill,
             datalabels.size = datalabels.size,
             datalabels.angle = datalabels.angle,
             datalabels.lineheight = datalabels.lineheight,
             decimal.mark = decimal.mark,
             big.mark = big.mark,
             summarise_function = summarise_function,
             stacked = stacked,
             stacked_fill = stacked_fill,
             horizontal = horizontal,
             reverse = reverse,
             smooth = smooth,
             smooth.method = smooth.method,
             smooth.formula = smooth.formula,
             smooth.se = smooth.se,
             smooth.level = smooth.level,
             smooth.alpha = smooth.alpha,
             smooth.linewidth = smooth.linewidth,
             smooth.linetype = smooth.linetype,
             smooth.colour = smooth.colour,
             size = size,
             linetype = linetype,
             linewidth = linewidth,
             binwidth = binwidth,
             width = width,
             jitter_seed = jitter_seed,
             violin_scale = violin_scale,
             legend.position = legend.position,
             legend.title = {{ legend.title }},
             legend.reverse = legend.reverse,
             legend.barheight = legend.barheight,
             legend.barwidth = legend.barwidth,
             legend.nbin = legend.nbin,
             legend.italic = legend.italic,
             sankey.node_width = sankey.node_width,
             sankey.node_whitespace = sankey.node_whitespace,
             sankey.alpha = sankey.alpha,
             sankey.remove_axes = sankey.remove_axes,
             zoom = zoom,
             sep = sep,
             print = print,
             text_factor = text_factor,
             font = font,
             theme = theme,
             background = background,
             markdown = markdown,
             `_misses.x` = missing(x),
             `_misses.y` = missing(y),
             `_misses.category` = missing(category),
             `_misses.facet` = missing(facet),
             `_misses.datalabels` = missing(datalabels),
             `_misses.colour_fill` = missing(colour_fill),
             `_misses.x.title` = missing(x.title),
             `_misses.y.title` = missing(y.title),
             `_misses.title` = missing(title),
             `_misses.subtitle` = missing(subtitle),
             `_misses.tag` = missing(tag),
             `_misses.caption` = missing(caption),
             `_misses.y.percent` = missing(y.percent),
             `_misses.y.percent_break` = missing(y.percent_break),
             `_misses.x.zoom` = missing(x.zoom),
             `_misses.x.max_items` = missing(x.max_items),
             `_misses.facet.fixed_x` = missing(facet.fixed_x),
             `_label.x` = "item",
             `_label.y` = "count",
             `_label.category` = deparse(substitute(category)),
             `_label.facet` = deparse(substitute(facet)),
             `_label.y_secondary` = deparse(substitute(y_secondary)),
             `_summarise_fn_name` = deparse(substitute(summarise_function)),
             `_misses.summarise_function` = missing(summarise_function),
             ...)
}

#' @rdname plot2-methods
#' @details For geographic information system (GIS) analysis, use the `sf` package with a data set containing geometries. The result can be used as input for [plot2()].
#' @param crs the coordinate reference system (CRS) to use. If this is not left blank, [sf::st_transform()] will be used to transform the geometric data to the new CRS.
#' @param datalabels.centroid a [logical] to indicate whether datalabels must be centred on the polygon (using [sf::st_centroid()], the default), or be placed on the 'best' spot on the surface (using [sf::st_point_on_surface()])
#' @export
plot2.sf <- function(.data,
                     x = NULL,
                     y = NULL,
                     category = NULL,
                     facet = NULL,
                     type = NULL,
                     x.title = FALSE,
                     y.title = FALSE,
                     category.title = NULL,
                     title = NULL,
                     subtitle = NULL,
                     caption = NULL,
                     tag = NULL,
                     title.linelength = 60,
                     title.colour = getOption("plot2.colour_font_primary", "black"),
                     subtitle.linelength = 60,
                     subtitle.colour = getOption("plot2.colour_font_secondary", "grey35"),
                     na.replace = "",
                     na.rm = FALSE,
                     facet.position = "top",
                     facet.fill = NULL,
                     facet.bold = TRUE,
                     facet.italic = FALSE,
                     facet.size = 10,
                     facet.margin = 8,
                     facet.repeat_lbls_x = TRUE,
                     facet.repeat_lbls_y = NULL,
                     facet.fixed_y = NULL,
                     facet.fixed_x = NULL,
                     facet.drop = FALSE,
                     facet.nrow = NULL,
                     facet.relative = FALSE,
                     x.date_breaks = NULL,
                     x.date_labels = NULL,
                     x.date_remove_years = NULL,
                     category.focus = NULL,
                     colour = getOption("plot2.colour_sf", "grey50"),
                     colour_fill = getOption("plot2.colour_sf_fill", getOption("plot2.colour", "ggplot2")),
                     colour_opacity = 0,
                     x.lbl_angle = 0,
                     x.lbl_align = NULL,
                     x.lbl_italic = FALSE,
                     x.lbl_taxonomy = FALSE,
                     x.remove = FALSE,
                     x.position = "bottom",
                     x.max_items = Inf,
                     x.max_txt = "(rest, x%n)",
                     category.max_items = Inf,
                     category.max_txt = "(rest, x%n)",
                     facet.max_items = Inf,
                     facet.max_txt = "(rest, x%n)",
                     x.breaks = NULL,
                     x.n_breaks = NULL,
                     x.transform = "identity",
                     x.expand = 0,
                     x.limits = NULL,
                     x.labels = NULL,
                     x.character = NULL,
                     x.drop = FALSE,
                     x.mic = FALSE,
                     x.zoom = FALSE,
                     y.remove = FALSE,
                     y.24h = FALSE,
                     y.age = FALSE,
                     y.scientific = NULL,
                     y.percent = FALSE,
                     y.percent_break = 0.1,
                     y.breaks = NULL,
                     y.n_breaks = NULL,
                     y.limits = NULL,
                     y.labels = NULL,
                     y.expand = 0,
                     y.transform = "identity",
                     y.position = "left",
                     y.zoom = FALSE,
                     y_secondary = NULL,
                     y_secondary.type = type,
                     y_secondary.title = TRUE,
                     y_secondary.colour = get_colour(getOption("plot2.colour", "ggplot2"), 2),
                     y_secondary.colour_fill = get_colour(getOption("plot2.colour", "ggplot2"), 2),
                     y_secondary.scientific = NULL,
                     y_secondary.percent = FALSE,
                     y_secondary.labels = NULL,
                     category.labels = NULL,
                     category.percent = FALSE,
                     category.breaks = NULL,
                     category.limits = NULL,
                     category.expand = 0,
                     category.midpoint = NULL,
                     category.transform = "identity",
                     category.date_breaks = NULL,
                     category.date_labels = NULL,
                     category.character = NULL,
                     x.sort = NULL,
                     category.sort = TRUE,
                     facet.sort = TRUE,
                     x.complete = NULL,
                     category.complete = NULL,
                     facet.complete = NULL,
                     datalabels = TRUE,
                     datalabels.round = ifelse(y.percent, 2, 1),
                     datalabels.format = NULL,
                     datalabels.colour = "black",
                     datalabels.colour_fill = NULL,
                     datalabels.size = (3 * text_factor),
                     datalabels.angle = 0,
                     datalabels.lineheight = 1.0,
                     decimal.mark = dec_mark(),
                     big.mark = big_mark(),
                     summarise_function = base::sum,
                     stacked = FALSE,
                     stacked_fill = FALSE,
                     horizontal = FALSE,
                     reverse = horizontal,
                     smooth = NULL,
                     smooth.method = NULL,
                     smooth.formula = NULL,
                     smooth.se = TRUE,
                     smooth.level = 0.95,
                     smooth.alpha = 0.25,
                     smooth.linewidth = 0.75,
                     smooth.linetype = 3,
                     smooth.colour = NULL,
                     size = NULL,
                     linetype = 1,
                     linewidth = NULL,
                     binwidth = NULL,
                     width = NULL,
                     jitter_seed = NA,
                     violin_scale = "count",
                     legend.position = "right",
                     legend.title = NULL,
                     legend.reverse = FALSE,
                     legend.barheight = 6,
                     legend.barwidth = 1.5,
                     legend.nbin = 300,
                     legend.italic = FALSE,
                     sankey.node_width = 0.15,
                     sankey.node_whitespace = 0.03,
                     sankey.alpha = 0.5,
                     sankey.remove_axes = NULL,
                     zoom = FALSE,
                     sep = " / ",
                     print = FALSE,
                     text_factor = getOption("plot2.text_factor", 1),
                     font = getOption("plot2.font"),
                     theme = theme_minimal2(panel.grid.major = element_blank(),
                                            panel.grid.minor = element_blank(),
                                            panel.border = element_blank(),
                                            plot.margin = unit(c(5, 5, 0, 0), units = "pt"),
                                            axis.title = element_blank(),
                                            axis.text = element_blank(),
                                            axis.line = element_blank(),
                                            axis.ticks = element_blank()),
                     background = getOption("plot2.colour_background", "white"),
                     markdown = TRUE,
                     data = NULL,
                     crs = NULL,
                     datalabels.centroid = NULL,
                     ...) {
  
  loadNamespace("sf") # will throw an error if not installed
  
  if (!inherits(.data, "sf")) {
    plot2_caution("Transforming plot data to an sf model using ", font_blue("sf::st_as_sf()"))
    .data <- sf::st_as_sf(.data)
  }
  if (!is.null(crs)) {
    .data <- sf::st_transform(.data, crs = crs)
  }
  
  if (!is.null(x)) {
    plot2_warning("In 'sf' plots, ", font_blue("x"), " will be ignored - did you mean ", font_blue("category"), "?")
  }
  if (!is.null(y)) {
    plot2_warning("In 'sf' plots, ", font_blue("y"), " will be ignored - did you mean ", font_blue("category"), "?")
  }
  if (!missing(colour) && !identical(colour, "white")) {
    plot2_message("In 'sf' plots, " , font_blue("colour"), " will set the borders, not the areas - did you mean ", font_blue(paste0("colour_fill = ", deparse(colour))), "?")
  }
  
  df <- .data
  df$x <- ""
  df$y <- 0
  
  plot2_exec(.data = df,
             x = x,
             y = y,
             category = {{ category }},
             facet = {{ facet }},
             type = "sf",
             x.title = {{ x.title }},
             y.title = {{ y.title }},
             category.title = {{ category.title }},
             title = {{ title }},
             subtitle = {{ subtitle }},
             caption = {{ caption }},
             tag = {{ tag }},
             title.linelength = title.linelength,
             title.colour = title.colour,
             subtitle.linelength = subtitle.linelength,
             subtitle.colour = subtitle.colour,
             na.replace = na.replace,
             na.rm = na.rm,
             facet.position = facet.position,
             facet.fill = facet.fill,
             facet.bold = facet.bold,
             facet.italic = facet.italic,
             facet.size = facet.size,
             facet.margin = facet.margin,
             facet.repeat_lbls_x = facet.repeat_lbls_x,
             facet.repeat_lbls_y = facet.repeat_lbls_y,
             facet.fixed_y = facet.fixed_y,
             facet.fixed_x = facet.fixed_x,
             facet.drop = facet.drop,
             facet.nrow = facet.nrow,
             facet.relative = facet.relative,
             x.date_breaks = x.date_breaks,
             x.date_labels = x.date_labels,
             x.date_remove_years = x.date_remove_years,
             category.focus = category.focus,
             colour = colour,
             colour_fill = colour_fill,
             colour_opacity = colour_opacity,
             x.lbl_angle = x.lbl_angle,
             x.lbl_align = x.lbl_align,
             x.lbl_italic = x.lbl_italic,
             x.lbl_taxonomy = x.lbl_taxonomy,
             x.remove = x.remove,
             x.position = x.position,
             x.max_items = x.max_items,
             x.max_txt = x.max_txt,
             category.max_items = category.max_items,
             category.max_txt = category.max_txt,
             facet.max_items = facet.max_items,
             facet.max_txt = facet.max_txt,
             x.breaks = x.breaks,
             x.n_breaks = x.n_breaks,
             x.transform = x.transform,
             x.expand = x.expand,
             x.limits = x.limits,
             x.labels = x.labels,
             x.character = x.character,
             x.drop = x.drop,
             x.mic = x.mic,
             x.zoom = x.zoom,
             y.remove = y.remove,
             y.24h = y.24h,
             y.age = y.age,
             y.scientific = y.scientific,
             y.percent = y.percent,
             y.percent_break = y.percent_break,
             y.breaks = y.breaks,
             y.n_breaks = y.n_breaks,
             y.limits = y.limits,
             y.labels = y.labels,
             y.expand = y.expand,
             y.transform = y.transform,
             y.position = y.position,
             y.zoom = y.zoom,
             y_secondary = NULL,
             y_secondary.type = NULL,
             y_secondary.title = TRUE,
             y_secondary.colour = NULL,
             y_secondary.colour_fill = NULL,
             y_secondary.scientific = NULL,
             y_secondary.percent = NULL,
             y_secondary.labels = NULL,
             category.labels = category.labels,
             category.percent = category.percent,
             category.breaks = category.breaks,
             category.limits = category.limits,
             category.expand = category.expand,
             category.midpoint = category.midpoint,
             category.transform = category.transform,
             category.date_breaks = category.date_breaks,
             category.date_labels = category.date_labels,
             category.character = category.character,
             x.sort = x.sort,
             category.sort = category.sort,
             facet.sort = facet.sort,
             x.complete = x.complete,
             category.complete = category.complete,
             facet.complete = facet.complete,
             datalabels = {{ datalabels }},
             datalabels.round = datalabels.round,
             datalabels.colour = datalabels.colour,
             datalabels.format = datalabels.format,
             datalabels.colour_fill = datalabels.colour_fill,
             datalabels.size = datalabels.size,
             datalabels.angle = datalabels.angle,
             datalabels.lineheight = datalabels.lineheight,
             decimal.mark = decimal.mark,
             big.mark = big.mark,
             summarise_function = summarise_function,
             stacked = stacked,
             stacked_fill = stacked_fill,
             horizontal = horizontal,
             reverse = reverse,
             smooth = smooth,
             smooth.method = smooth.method,
             smooth.formula = smooth.formula,
             smooth.se = smooth.se,
             smooth.level = smooth.level,
             smooth.alpha = smooth.alpha,
             smooth.linewidth = smooth.linewidth,
             smooth.linetype = smooth.linetype,
             smooth.colour = smooth.colour,
             size = size,
             linetype = linetype,
             linewidth = linewidth,
             binwidth = binwidth,
             width = width,
             jitter_seed = jitter_seed,
             violin_scale = violin_scale,
             legend.position = legend.position,
             legend.title = {{ legend.title }},
             legend.reverse = legend.reverse,
             legend.barheight = legend.barheight,
             legend.barwidth = legend.barwidth,
             legend.nbin = legend.nbin,
             legend.italic = legend.italic,
             sankey.node_width = sankey.node_width,
             sankey.node_whitespace = sankey.node_whitespace,
             sankey.alpha = sankey.alpha,
             sankey.remove_axes = sankey.remove_axes,
             zoom = zoom,
             sep = sep,
             print = print,
             text_factor = text_factor,
             font = font,
             theme = theme,
             background = background,
             markdown = markdown,
             `_misses.x` = FALSE,
             `_misses.y` = FALSE,
             `_misses.category` = missing(category),
             `_misses.facet` = missing(facet),
             `_misses.datalabels` = missing(datalabels),
             `_misses.colour_fill` = missing(colour_fill),
             `_misses.x.title` = missing(x.title),
             `_misses.y.title` = missing(y.title),
             `_misses.title` = missing(title),
             `_misses.subtitle` = missing(subtitle),
             `_misses.tag` = missing(tag),
             `_misses.caption` = missing(caption),
             `_misses.y.percent` = missing(y.percent),
             `_misses.y.percent_break` = missing(y.percent_break),
             `_misses.x.zoom` = missing(x.zoom),
             `_misses.x.max_items` = missing(x.max_items),
             `_misses.facet.fixed_x` = missing(facet.fixed_x),
             `_label.x` = deparse(substitute(x)),
             `_label.y` = deparse(substitute(y)),
             `_label.category` = deparse(substitute(category)),
             `_label.facet` = deparse(substitute(facet)),
             `_summarise_fn_name` = deparse(substitute(summarise_function)),
             `_misses.summarise_function` = missing(summarise_function),
             `_sf.column` = attributes(.data)$sf_column,
             `_datalabels.centroid` = datalabels.centroid,
             ...)
}

#' @rdname plot2-methods
#' @importFrom dplyr is_grouped_df ungroup
#' @export
plot2.data.frame <- function(.data,
                             x = NULL,
                             y = NULL,
                             category = NULL,
                             facet = NULL,
                             type = NULL,
                             x.title = TRUE,
                             y.title = TRUE,
                             category.title = NULL,
                             title = NULL,
                             subtitle = NULL,
                             caption = NULL,
                             tag = NULL,
                             title.linelength = 60,
                             title.colour = getOption("plot2.colour_font_primary", "black"),
                             subtitle.linelength = 60,
                             subtitle.colour = getOption("plot2.colour_font_secondary", "grey35"),
                             na.replace = "",
                             na.rm = FALSE,
                             facet.position = "top",
                             facet.fill = NULL,
                             facet.bold = TRUE,
                             facet.italic = FALSE,
                             facet.size = 10,
                             facet.margin = 8,
                             facet.repeat_lbls_x = TRUE,
                             facet.repeat_lbls_y = NULL,
                             facet.fixed_y = NULL,
                             facet.fixed_x = NULL,
                             facet.drop = FALSE,
                             facet.nrow = NULL,
                             facet.relative = FALSE,
                             x.date_breaks = NULL,
                             x.date_labels = NULL,
                             x.date_remove_years = NULL,
                             category.focus = NULL,
                             colour = getOption("plot2.colour", "ggplot2"),
                             colour_fill = NULL,
                             colour_opacity = 0,
                             x.lbl_angle = 0,
                             x.lbl_align = NULL,
                             x.lbl_italic = FALSE,
                             x.lbl_taxonomy = FALSE,
                             x.remove = FALSE,
                             x.position = "bottom",
                             x.max_items = Inf,
                             x.max_txt = "(rest, x%n)",
                             category.max_items = Inf,
                             category.max_txt = "(rest, x%n)",
                             facet.max_items = Inf,
                             facet.max_txt = "(rest, x%n)",
                             x.breaks = NULL,
                             x.n_breaks = NULL,
                             x.transform = "identity",
                             x.expand = NULL,
                             x.limits = NULL,
                             x.labels = NULL,
                             x.character = NULL,
                             x.drop = FALSE,
                             x.mic = FALSE,
                             x.zoom = FALSE,
                             y.remove = FALSE,
                             y.24h = FALSE,
                             y.age = FALSE,
                             y.scientific = NULL,
                             y.percent = FALSE,
                             y.percent_break = 0.1,
                             y.breaks = NULL,
                             y.n_breaks = NULL,
                             y.limits = NULL,
                             y.labels = NULL,
                             y.expand = NULL,
                             y.transform = "identity",
                             y.position = "left",
                             y.zoom = FALSE,
                             y_secondary = NULL,
                             y_secondary.type = type,
                             y_secondary.title = TRUE,
                             y_secondary.colour = get_colour(getOption("plot2.colour", "ggplot2"), 2),
                             y_secondary.colour_fill = get_colour(getOption("plot2.colour", "ggplot2"), 2),
                             y_secondary.scientific = NULL,
                             y_secondary.percent = FALSE,
                             y_secondary.labels = NULL,
                             category.labels = NULL,
                             category.percent = FALSE,
                             category.breaks = NULL,
                             category.limits = NULL,
                             category.expand = 0,
                             category.midpoint = NULL,
                             category.transform = "identity",
                             category.date_breaks = NULL,
                             category.date_labels = NULL,
                             category.character = NULL,
                             x.sort = NULL,
                             category.sort = TRUE,
                             facet.sort = TRUE,
                             x.complete = NULL,
                             category.complete = NULL,
                             facet.complete = NULL,
                             datalabels = TRUE,
                             datalabels.round = ifelse(y.percent, 2, 1),
                             datalabels.format = "%n",
                             datalabels.colour = "grey25",
                             datalabels.colour_fill = NULL,
                             datalabels.size = (3 * text_factor),
                             datalabels.angle = 0,
                             datalabels.lineheight = 1.0,
                             decimal.mark = dec_mark(),
                             big.mark = big_mark(),
                             summarise_function = base::sum,
                             stacked = FALSE,
                             stacked_fill = FALSE,
                             horizontal = FALSE,
                             reverse = horizontal,
                             smooth = NULL,
                             smooth.method = NULL,
                             smooth.formula = NULL,
                             smooth.se = TRUE,
                             smooth.level = 0.95,
                             smooth.alpha = 0.25,
                             smooth.linewidth = 0.75,
                             smooth.linetype = 3,
                             smooth.colour = NULL,
                             size = NULL,
                             linetype = 1,
                             linewidth = NULL,
                             binwidth = NULL,
                             width = NULL,
                             jitter_seed = NA,
                             violin_scale = "count",
                             legend.position = NULL,
                             legend.title = NULL, # TRUE in numeric categories
                             legend.reverse = FALSE,
                             legend.barheight = 6,
                             legend.barwidth = 1.5,
                             legend.nbin = 300,
                             legend.italic = FALSE,
                             sankey.node_width = 0.15,
                             sankey.node_whitespace = 0.03,
                             sankey.alpha = 0.5,
                             sankey.remove_axes = NULL,
                             zoom = FALSE,
                             sep = " / ",
                             print = FALSE,
                             text_factor = getOption("plot2.text_factor", 1),
                             font = getOption("plot2.font"),
                             theme = getOption("plot2.theme", "theme_minimal2"),
                             background = getOption("plot2.colour_background", "white"),
                             markdown = TRUE,
                             ...) {
  
  if (isTRUE(is_grouped_df(.data))) {
    .data <- ungroup(.data)
  }
  
  plot2_exec(.data = .data,
             x = {{ x }},
             y = {{ y }},
             category = {{ category }},
             facet = {{ facet }},
             type = type,
             x.title = {{ x.title }},
             y.title = {{ y.title }},
             category.title = {{ category.title }},
             title = {{ title }},
             subtitle = {{ subtitle }},
             caption = {{ caption }},
             tag = {{ tag }},
             title.linelength = title.linelength,
             title.colour = title.colour,
             subtitle.linelength = subtitle.linelength,
             subtitle.colour = subtitle.colour,
             na.replace = na.replace,
             na.rm = na.rm,
             facet.position = facet.position,
             facet.fill = facet.fill,
             facet.bold = facet.bold,
             facet.italic = facet.italic,
             facet.size = facet.size,
             facet.margin = facet.margin,
             facet.repeat_lbls_x = facet.repeat_lbls_x,
             facet.repeat_lbls_y = facet.repeat_lbls_y,
             facet.fixed_y = facet.fixed_y,
             facet.fixed_x = facet.fixed_x,
             facet.drop = facet.drop,
             facet.nrow = facet.nrow,
             facet.relative = facet.relative,
             x.date_breaks = x.date_breaks,
             x.date_labels = x.date_labels,
             x.date_remove_years = x.date_remove_years,
             category.focus = category.focus,
             colour = colour,
             colour_fill = colour_fill,
             colour_opacity = colour_opacity,
             x.lbl_angle = x.lbl_angle,
             x.lbl_align = x.lbl_align,
             x.lbl_italic = x.lbl_italic,
             x.lbl_taxonomy = x.lbl_taxonomy,
             x.remove = x.remove,
             x.position = x.position,
             x.max_items = x.max_items,
             x.max_txt = x.max_txt,
             category.max_items = category.max_items,
             category.max_txt = category.max_txt,
             facet.max_items = facet.max_items,
             facet.max_txt = facet.max_txt,
             x.breaks = x.breaks,
             x.n_breaks = x.n_breaks,
             x.transform = x.transform,
             x.expand = x.expand,
             x.limits = x.limits,
             x.labels = x.labels,
             x.character = x.character,
             x.drop = x.drop,
             x.mic = x.mic,
             x.zoom = x.zoom,
             y.remove = y.remove,
             y.24h = y.24h,
             y.age = y.age,
             y.scientific = y.scientific,
             y.percent = y.percent,
             y.percent_break = y.percent_break,
             y.breaks = y.breaks,
             y.n_breaks = y.n_breaks,
             y.limits = y.limits,
             y.labels = y.labels,
             y.expand = y.expand,
             y.transform = y.transform,
             y.position = y.position,
             y.zoom = y.zoom,
             y_secondary = {{ y_secondary }},
             y_secondary.type = y_secondary.type,
             y_secondary.title = {{ y_secondary.title }},
             y_secondary.colour = y_secondary.colour,
             y_secondary.colour_fill = y_secondary.colour_fill,
             y_secondary.scientific = y_secondary.scientific,
             y_secondary.percent = y_secondary.percent,
             y_secondary.labels = y_secondary.labels,
             category.labels = category.labels,
             category.percent = category.percent,
             category.breaks = category.breaks,
             category.limits = category.limits,
             category.expand = category.expand,
             category.midpoint = category.midpoint,
             category.transform = category.transform,
             category.date_breaks = category.date_breaks,
             category.date_labels = category.date_labels,
             category.character = category.character,
             x.sort = x.sort,
             category.sort = category.sort,
             facet.sort = facet.sort,
             x.complete = x.complete,
             category.complete = category.complete,
             facet.complete = facet.complete,
             datalabels = {{ datalabels }},
             datalabels.round = datalabels.round,
             datalabels.colour = datalabels.colour,
             datalabels.format = datalabels.format,
             datalabels.colour_fill = datalabels.colour_fill,
             datalabels.size = datalabels.size,
             datalabels.angle = datalabels.angle,
             datalabels.lineheight = datalabels.lineheight,
             decimal.mark = decimal.mark,
             big.mark = big.mark,
             summarise_function = summarise_function,
             stacked = stacked,
             stacked_fill = stacked_fill,
             horizontal = horizontal,
             reverse = reverse,
             smooth = smooth,
             smooth.method = smooth.method,
             smooth.formula = smooth.formula,
             smooth.se = smooth.se,
             smooth.level = smooth.level,
             smooth.alpha = smooth.alpha,
             smooth.linewidth = smooth.linewidth,
             smooth.linetype = smooth.linetype,
             smooth.colour = smooth.colour,
             size = size,
             linetype = linetype,
             linewidth = linewidth,
             binwidth = binwidth,
             width = width,
             jitter_seed = jitter_seed,
             violin_scale = violin_scale,
             legend.position = legend.position,
             legend.title = {{ legend.title }},
             legend.reverse = legend.reverse,
             legend.barheight = legend.barheight,
             legend.barwidth = legend.barwidth,
             legend.nbin = legend.nbin,
             legend.italic = legend.italic,
             sankey.node_width = sankey.node_width,
             sankey.node_whitespace = sankey.node_whitespace,
             sankey.alpha = sankey.alpha,
             sankey.remove_axes = sankey.remove_axes,
             zoom = zoom,
             sep = sep,
             print = print,
             text_factor = text_factor,
             font = font,
             theme = theme,
             background = background,
             markdown = markdown,
             `_misses.x` = missing(x),
             `_misses.y` = missing(y),
             `_misses.category` = missing(category),
             `_misses.facet` = missing(facet),
             `_misses.datalabels` = missing(datalabels),
             `_misses.colour_fill` = missing(colour_fill),
             `_misses.x.title` = missing(x.title),
             `_misses.y.title` = missing(y.title),
             `_misses.title` = missing(title),
             `_misses.subtitle` = missing(subtitle),
             `_misses.tag` = missing(tag),
             `_misses.caption` = missing(caption),
             `_misses.y.percent` = missing(y.percent),
             `_misses.y.percent_break` = missing(y.percent_break),
             `_misses.x.zoom` = missing(x.zoom),
             `_misses.x.max_items` = missing(x.max_items),
             `_misses.facet.fixed_x` = missing(facet.fixed_x),
             `_label.x` = list(...)$`_label.x` %or% deparse(substitute(x)),
             `_label.y` = list(...)$`_label.y` %or% deparse(substitute(y)),
             `_label.category` = list(...)$`_label.category` %or% deparse(substitute(category)),
             `_label.facet` = list(...)$`_label.facet` %or% deparse(substitute(facet)),
             `_label.y_secondary` = list(...)$`_label.y_secondary` %or% deparse(substitute(y_secondary)),
             `_label.y_secondary` = list(...)$`_label.y_secondary` %or% deparse(substitute(y_secondary)),
             `_summarise_fn_name` = list(...)$`_summarise_fn_name` %or% deparse(substitute(summarise_function)),
             `_misses.summarise_function` = missing(summarise_function),
             ...) 
}

#' @rdname plot2-methods
#' @importFrom tidyr pivot_longer
#' @importFrom tibble rownames_to_column
#' @importFrom dplyr rename
#' @export
plot2.matrix <- function(.data,
                         x = NULL,
                         y = NULL,
                         category = NULL,
                         facet = NULL,
                         type = NULL,
                         x.title = FALSE,
                         y.title = FALSE,
                         category.title = NULL,
                         title = NULL,
                         subtitle = NULL,
                         caption = NULL,
                         tag = NULL,
                         title.linelength = 60,
                         title.colour = getOption("plot2.colour_font_primary", "black"),
                         subtitle.linelength = 60,
                         subtitle.colour = getOption("plot2.colour_font_secondary", "grey35"),
                         na.replace = "",
                         na.rm = FALSE,
                         facet.position = "top",
                         facet.fill = NULL,
                         facet.bold = TRUE,
                         facet.italic = FALSE,
                         facet.size = 10,
                         facet.margin = 8,
                         facet.repeat_lbls_x = TRUE,
                         facet.repeat_lbls_y = NULL,
                         facet.fixed_y = NULL,
                         facet.fixed_x = NULL,
                         facet.drop = FALSE,
                         facet.nrow = NULL,
                         facet.relative = FALSE,
                         x.date_breaks = NULL,
                         x.date_labels = NULL,
                         x.date_remove_years = NULL,
                         category.focus = NULL,
                         colour = getOption("plot2.colour", "ggplot2"),
                         colour_fill = NULL,
                         colour_opacity = 0,
                         x.lbl_angle = 0,
                         x.lbl_align = NULL,
                         x.lbl_italic = FALSE,
                         x.lbl_taxonomy = FALSE,
                         x.remove = FALSE,
                         x.position = "bottom",
                         x.max_items = Inf,
                         x.max_txt = "(rest, x%n)",
                         category.max_items = Inf,
                         category.max_txt = "(rest, x%n)",
                         facet.max_items = Inf,
                         facet.max_txt = "(rest, x%n)",
                         x.breaks = NULL,
                         x.n_breaks = NULL,
                         x.transform = "identity",
                         x.expand = NULL,
                         x.limits = NULL,
                         x.labels = NULL,
                         x.character = NULL,
                         x.drop = FALSE,
                         x.mic = FALSE,
                         x.zoom = FALSE,
                         y.remove = FALSE,
                         y.24h = FALSE,
                         y.age = FALSE,
                         y.scientific = NULL,
                         y.percent = FALSE,
                         y.percent_break = 0.1,
                         y.breaks = NULL,
                         y.n_breaks = NULL,
                         y.limits = NULL,
                         y.labels = NULL,
                         y.expand = NULL,
                         y.transform = "identity",
                         y.position = "left",
                         y.zoom = FALSE,
                         y_secondary = NULL,
                         y_secondary.type = type,
                         y_secondary.title = TRUE,
                         y_secondary.colour = get_colour(getOption("plot2.colour", "ggplot2"), 2),
                         y_secondary.colour_fill = get_colour(getOption("plot2.colour", "ggplot2"), 2),
                         y_secondary.scientific = NULL,
                         y_secondary.percent = FALSE,
                         y_secondary.labels = NULL,
                         category.labels = NULL,
                         category.percent = FALSE,
                         category.breaks = NULL,
                         category.limits = NULL,
                         category.expand = 0,
                         category.midpoint = NULL,
                         category.transform = "identity",
                         category.date_breaks = NULL,
                         category.date_labels = NULL,
                         category.character = NULL,
                         x.sort = NULL,
                         category.sort = TRUE,
                         facet.sort = TRUE,
                         x.complete = NULL,
                         category.complete = NULL,
                         facet.complete = NULL,
                         datalabels = TRUE,
                         datalabels.round = ifelse(y.percent, 2, 1),
                         datalabels.format = "%n",
                         datalabels.colour = "grey25",
                         datalabels.colour_fill = NULL,
                         datalabels.size = (3 * text_factor),
                         datalabels.angle = 0,
                         datalabels.lineheight = 1.0,
                         decimal.mark = dec_mark(),
                         big.mark = big_mark(),
                         summarise_function = base::sum,
                         stacked = FALSE,
                         stacked_fill = FALSE,
                         horizontal = FALSE,
                         reverse = horizontal,
                         smooth = NULL,
                         smooth.method = NULL,
                         smooth.formula = NULL,
                         smooth.se = TRUE,
                         smooth.level = 0.95,
                         smooth.alpha = 0.25,
                         smooth.linewidth = 0.75,
                         smooth.linetype = 3,
                         smooth.colour = NULL,
                         size = NULL,
                         linetype = 1,
                         linewidth = NULL,
                         binwidth = NULL,
                         width = NULL,
                         jitter_seed = NA,
                         violin_scale = "count",
                         legend.position = NULL,
                         legend.title = NULL, # TRUE in numeric categories
                         legend.reverse = FALSE,
                         legend.barheight = 6,
                         legend.barwidth = 1.5,
                         legend.nbin = 300,
                         legend.italic = FALSE,
                         sankey.node_width = 0.15,
                         sankey.node_whitespace = 0.03,
                         sankey.alpha = 0.5,
                         sankey.remove_axes = NULL,
                         zoom = FALSE,
                         sep = " / ",
                         print = FALSE,
                         text_factor = getOption("plot2.text_factor", 1),
                         font = getOption("plot2.font"),
                         theme = getOption("plot2.theme", "theme_minimal2"),
                         background = getOption("plot2.colour_background", "white"),
                         markdown = TRUE,
                         ...) {
  
  df <- .data |>
    as.data.frame(stringsAsFactors = FALSE)
  
  if (is.null(type) && identical(rownames(df), colnames(df))) {
    # rows and columns are identical, while the data are numeric
    # this is the outcome of cor(), a correlation matrix
    # assume type tile
    plot2_message("Assuming ", font_blue("type = \"tile\""),
                  " since the matrix contains identical row and column names")
    type <- "tile"
    # make long format
    df <- df |> 
      rownames_to_column(var = "rowname") |> 
      pivot_longer(-rowname, names_to = "y", values_to = "category") |> 
      rename(x = rowname)
  } else if (!identical(rownames(df), as.character(seq_len(nrow(df))))) {
    df <- df |> 
      rownames_to_column(var = "x")
  }
  
  df |> 
    plot2_exec(x = x,
               y = y,
               category = category,
               facet = NULL,
               type = type,
               x.title = {{ x.title }},
               y.title = {{ y.title }},
               category.title = {{ category.title }},
               title = {{ title }},
               subtitle = {{ subtitle }},
               caption = {{ caption }},
               tag = {{ tag }},
               title.linelength = title.linelength,
               title.colour = title.colour,
               subtitle.linelength = subtitle.linelength,
               subtitle.colour = subtitle.colour,
               na.replace = na.replace,
               na.rm = na.rm,
               facet.position = facet.position,
               facet.fill = facet.fill,
               facet.bold = facet.bold,
               facet.italic = facet.italic,
               facet.size = facet.size,
               facet.margin = facet.margin,
               facet.repeat_lbls_x = facet.repeat_lbls_x,
               facet.repeat_lbls_y = facet.repeat_lbls_y,
               facet.fixed_y = facet.fixed_y,
               facet.fixed_x = facet.fixed_x,
               facet.drop = facet.drop,
               facet.nrow = facet.nrow,
               facet.relative = facet.relative,
               x.date_breaks = x.date_breaks,
               x.date_labels = x.date_labels,
               x.date_remove_years = x.date_remove_years,
               category.focus = category.focus,
               colour = colour,
               colour_fill = colour_fill,
               colour_opacity = colour_opacity,
               x.lbl_angle = x.lbl_angle,
               x.lbl_align = x.lbl_align,
               x.lbl_italic = x.lbl_italic,
               x.lbl_taxonomy = x.lbl_taxonomy,
               x.remove = x.remove,
               x.position = x.position,
               x.max_items = x.max_items,
               x.max_txt = x.max_txt,
               category.max_items = category.max_items,
               category.max_txt = category.max_txt,
               facet.max_items = facet.max_items,
               facet.max_txt = facet.max_txt,
               x.breaks = x.breaks,
               x.n_breaks = x.n_breaks,
               x.transform = x.transform,
               x.expand = x.expand,
               x.limits = x.limits,
               x.labels = x.labels,
               x.character = x.character,
               x.drop = x.drop,
               x.mic = x.mic,
               x.zoom = x.zoom,
               y.remove = y.remove,
               y.24h = y.24h,
               y.age = y.age,
               y.scientific = y.scientific,
               y.percent = y.percent,
               y.percent_break = y.percent_break,
               y.breaks = y.breaks,
               y.n_breaks = y.n_breaks,
               y.limits = y.limits,
               y.labels = y.labels,
               y.expand = y.expand,
               y.transform = y.transform,
               y.position = y.position,
               y.zoom = y.zoom,
               y_secondary = {{ y_secondary }},
               y_secondary.type = y_secondary.type,
               y_secondary.title = {{ y_secondary.title }},
               y_secondary.colour = y_secondary.colour,
               y_secondary.colour_fill = y_secondary.colour_fill,
               y_secondary.scientific = y_secondary.scientific,
               y_secondary.percent = y_secondary.percent,
               y_secondary.labels = y_secondary.labels,
               category.labels = category.labels,
               category.percent = category.percent,
               category.breaks = category.breaks,
               category.limits = category.limits,
               category.expand = category.expand,
               category.midpoint = category.midpoint,
               category.transform = category.transform,
               category.date_breaks = category.date_breaks,
               category.date_labels = category.date_labels,
               category.character = category.character,
               x.sort = x.sort,
               category.sort = category.sort,
               facet.sort = facet.sort,
               x.complete = x.complete,
               category.complete = category.complete,
               facet.complete = facet.complete,
               datalabels = {{ datalabels }},
               datalabels.round = datalabels.round,
               datalabels.colour = datalabels.colour,
               datalabels.format = datalabels.format,
               datalabels.colour_fill = datalabels.colour_fill,
               datalabels.size = datalabels.size,
               datalabels.angle = datalabels.angle,
               datalabels.lineheight = datalabels.lineheight,
               decimal.mark = decimal.mark,
               big.mark = big.mark,
               summarise_function = summarise_function,
               stacked = stacked,
               stacked_fill = stacked_fill,
               horizontal = horizontal,
               reverse = reverse,
               smooth = smooth,
               smooth.method = smooth.method,
               smooth.formula = smooth.formula,
               smooth.se = smooth.se,
               smooth.level = smooth.level,
               smooth.alpha = smooth.alpha,
               smooth.linewidth = smooth.linewidth,
               smooth.linetype = smooth.linetype,
               smooth.colour = smooth.colour,
               size = size,
               linetype = linetype,
               linewidth = linewidth,
               binwidth = binwidth,
               width = width,
               jitter_seed = jitter_seed,
               violin_scale = violin_scale,
               legend.position = legend.position,
               legend.title = {{ legend.title }},
               legend.reverse = legend.reverse,
               legend.barheight = legend.barheight,
               legend.barwidth = legend.barwidth,
               legend.nbin = legend.nbin,
               legend.italic = legend.italic,
               sankey.node_width = sankey.node_width,
               sankey.node_whitespace = sankey.node_whitespace,
               sankey.alpha = sankey.alpha,
               sankey.remove_axes = sankey.remove_axes,
               zoom = zoom,
               sep = sep,
               print = print,
               text_factor = text_factor,
               font = font,
               theme = theme,
               background = background,
               markdown = markdown,
               `_misses.x` = missing(x),
               `_misses.y` = missing(y),
               `_misses.category` = missing(category),
               `_misses.facet` = missing(facet),
               `_misses.datalabels` = missing(datalabels),
               `_misses.colour_fill` = missing(colour_fill),
               `_misses.x.title` = missing(x.title),
               `_misses.y.title` = missing(y.title),
               `_misses.title` = missing(title),
               `_misses.subtitle` = missing(subtitle),
               `_misses.tag` = missing(tag),
               `_misses.caption` = missing(caption),
               `_misses.y.percent` = missing(y.percent),
               `_misses.y.percent_break` = missing(y.percent_break),
               `_misses.x.zoom` = missing(x.zoom),
               `_misses.x.max_items` = missing(x.max_items),
               `_misses.facet.fixed_x` = missing(facet.fixed_x),
               `_label.x` = deparse(substitute(x)),
               `_label.y` = deparse(substitute(y)),
               `_label.category` = deparse(substitute(category)),
               `_label.facet` = deparse(substitute(facet)),
               `_label.y_secondary` = deparse(substitute(y_secondary)),
               `_label.y_secondary` = deparse(substitute(y_secondary)),
               `_summarise_fn_name` = deparse(substitute(summarise_function)),
               `_misses.summarise_function` = missing(summarise_function),
               ...) 
}
